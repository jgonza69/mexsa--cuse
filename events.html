<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MEXSA @ Syracuse — Eventos</title>
  <meta name="description" content="Calendario de próximos eventos, talleres y recursos educativos de MEXSA @ Syracuse." />
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="images/mexsa1.png" />
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="index.html">MEXSA<span class="pill">SYR</span></a>
      <nav id="nav" class="nav">
        <a href="index.html">Inicio</a>
        <a href="events.html" aria-current="page">Eventos</a>
        <a href="about.html">Nosotros</a>
        <a href="join.html" class="cta">Únete</a>
      </nav>
      <button id="menuBtn" class="menu-btn" aria-expanded="false" aria-controls="nav" aria-label="Toggle menu">☰</button>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero hero--stadium" style="background-image:
    linear-gradient(180deg, rgba(10,15,10,.35), rgba(10,15,10,.85)),
    url('images/aquiestamos1.jpg');">
    <div class="hero__overlay">
      <div class="container hero__content">
        <h1 class="hero__title">Calendario & Recursos</h1>
        <p class="hero__subtitle">Talleres, fiestas, educación y solidaridad en el campus.</p>
      </div>
    </div>
  </section>

  <!-- Próximos eventos (dynamic from Google Sheet) -->
  <section class="section">
    <div class="container">
      <div class="section__head">
        <h2>Próximos eventos</h2>
      </div>

      <!-- Dynamic feed: ALL upcoming published events, sorted by soonest -->
      <div
        data-events-feed
        data-mode="upcoming"
        data-limit="0"
        data-image-rotate-ms="5000">
      </div>
      <!-- END dynamic feed -->
    </div>
  </section>

  <!-- Eventos pasados (dynamic from Google Sheet) -->
  <section class="strip">
    <div class="container">
      <div class="section__head">
        <h2>Eventos pasados</h2>
      </div>

      <!-- Dynamic feed: past events, newest first. Limit optional (0 = sin límite) -->
      <div
        data-events-feed
        data-mode="past"
        data-limit="0"
        data-image-rotate-ms="5000">
      </div>
    </div>
  </section>

  <!-- Calendario del semestre (dynamic from simple semester sheet) -->
  <section class="strip">
    <div class="container">
      <div class="section__head">
        <h2>Calendario del semestre</h2>
      </div>

      <!-- Dynamic month blocks (current + next month only, grouped) -->
      <div id="semester-calendar" class="grid" style="grid-template-columns: 1fr 1fr; gap:1rem;">
        <!-- JS will inject cards here -->
      </div>
    </div>
  </section>

  <!-- Educación: Día de los Muertos -->
  <section class="section section--dark" id="diadelosmuertos">
    <div class="container">
      <div class="section__head">
        <h2>Día de los Muertos — Serie educativa</h2>
      </div>
      <div class="newsgrid">
        <article class="card">
          <img class="card__img" src="images/diadelosmuertos1.jpeg" alt="¿Qué es Día de los Muertos?">
          <div class="card__body">
            <h3 class="card__title">¿Qué es?</h3>
            <p class="card__excerpt">Tradición para honrar la vida de quienes ya partieron. Ofrendas, memoria y comunidad.</p>
          </div>
        </article>
        <article class="card">
          <img class="card__img" src="images/diadelosmuertos2.jpeg" alt="Símbolos del Día de los Muertos">
          <div class="card__body">
            <h3 class="card__title">Símbolos</h3>
            <p class="card__excerpt">Cempasúchil, pan de muerto, calaveras de azúcar y velas.</p>
          </div>
        </article>
        <article class="card">
          <img class="card__img" src="images/aquiestamos1.jpg" alt="Origen del Día de los Muertos">
          <div class="card__body">
            <h3 class="card__title">Origen</h3>
            <p class="card__excerpt">Raíces mesoamericanas + tradiciones católicas; la mezcla que conocemos hoy.</p>
          </div>
        </article>
        <article class="card">
          <img class="card__img" src="images/tradiciones1.jpeg" alt="Tradiciones del Día de los Muertos">
          <div class="card__body">
            <h3 class="card__title">Tradiciones</h3>
            <p class="card__excerpt">Ofrendas con fotos y comida, visitas al panteón y arte popular.</p>
          </div>
        </article>
      </div>
    </div>
  </section>

  <!-- Know Your Rights + Alligator Alcatraz + Reading List -->
  <section class="section" id="recursos">
    <div class="container">
      <div class="section__head">
        <h2>Recursos & Solidaridad</h2>
      </div>

      <div class="grid" style="grid-template-columns:2fr 1fr; gap:1rem;">
        <article class="card" id="kyrights">
          <img class="card__img" src="images/mexsa2.png" alt="Conoce tus derechos">
          <div class="card__body">
            <h3 class="card__title">Conoce tus derechos (bilingüe)</h3>
            <p class="card__excerpt">Qué hacer si tienes contacto con ICE o la policía. Mantén la calma; no firmes nada sin representación legal.</p>
            <div class="grid" style="grid-template-columns:1fr 1fr;gap:.5rem;">
              <a class="btn secondary" href="#" onclick="alert('PDF en preparación'); return false;">Descargar (EN)</a>
              <a class="btn secondary" href="#" onclick="alert('PDF en preparación'); return false;">Descargar (ES)</a>
            </div>
          </div>
        </article>

        <article class="card">
          <img class="card__img" src="images/aquiestamos1.jpg" alt="Alligator Alcatraz">
          <div class="card__body">
            <h3 class="card__title">Alligator Alcatraz</h3>
            <p class="card__excerpt">Infórmate sobre el centro de detención en los Everglades y cómo ayudar.</p>
            <a class="btn" target="_blank" rel="noopener" href="https://immigrantjustice.org/ways-to-help/">Translate · Donate · Show up</a>
          </div>
        </article>
      </div>

      <div class="card" id="lecturas" style="margin-top:1rem;">
        <div class="card__body">
          <h3 class="card__title">Lecturas recomendadas</h3>
          <p class="muted">Construye tu lista de lectura sobre historia, arte y migración.</p>
          <ul class="bullets">
            <li>Historia de México para principiantes (intro)</li>
            <li>Arte mexicano contemporáneo (catálogo breve)</li>
            <li>Migración y derechos humanos (lecturas base)</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="container footergrid">
      <div>
        <div class="brand brand--footer">MEXSA<span class="pill">SYR</span></div>
        <p class="muted">Cultura, comunidad y orgullo mexicano en Syracuse University.</p>
      </div>
      <nav class="footernav">
        <a href="index.html">Inicio</a>
        <a href="events.html" aria-current="page">Eventos</a>
        <a href="about.html">Nosotros</a>
        <a href="join.html">Únete</a>
      </nav>
      <div class="footercta">
        <p class="muted">¿Preguntas? <a href="mailto:mexsacuse@gmail.com">mexsacuse@gmail.com</a></p>
        <a class="btn" href="join.html">Hazte miembro</a>
      </div>
    </div>
    <div class="container legal">
      <p>© <span id="year"></span> MEXSA @ Syracuse • All rights reserved.</p>
    </div>
  </footer>

  <script src="main.js"></script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>

  <!-- === Events feed (Google Sheet) — MEXSA events === -->
  <script>
    // ############## CONFIG (MEXSA events) ##############
    // Your existing MEXSA events Apps Script Web App endpoint:
    window.EVENTS_API_URL = 'https://script.google.com/macros/s/AKfycbwwH-QNELsaWFbyMexOt4abYJIXTtCd6EyerkzpJoMcYFGjOhxgLkwTPULZLwAZMINn/exec';
    // ############ END CONFIG ############
  </script>
  <script>
  (() => {
    const API = window.EVENTS_API_URL;
    const mounts = Array.from(document.querySelectorAll('[data-events-feed]'));
    if (!API || !mounts.length) return;

    // helper
    const el = (t, a={}, kids=[]) => {
      const n = document.createElement(t);
      for (const [k,v] of Object.entries(a)) {
        if (k === 'class') n.className = v;
        else if (k === 'html') n.innerHTML = v;
        else n.setAttribute(k, v);
      }
      kids.forEach(k => n.appendChild(typeof k === 'string' ? document.createTextNode(k) : k));
      return n;
    };

    // image rotator (with cache-bust + fallback)
    const imageRotator = (urls, rotateMs=5000) => {
      const wrap = el('div', { class: 'events-card__media' });
      const img = el('img', { alt: '', loading: 'lazy' });
      Object.assign(img.style, {
        width:'100%', height:'160px', objectFit:'cover',
        borderRadius:'12px', background:'#0f1a12'
      });

      const setSrc = (u) => {
        const clean = String(u||'').trim();
        const busted = clean ? clean + (clean.includes('?')?'&':'?') + 'v=' + Date.now() : '';
        img.onerror = () => { img.onerror = null; img.src = 'images/mexsa1.png'; };
        img.src = busted || 'images/mexsa1.png';
      };

      let i = 0;
      if (!urls || !urls.length) urls = ['images/mexsa1.png'];
      setSrc(urls[i]);
      wrap.appendChild(img);

      if (urls.length > 1 && rotateMs > 0) {
        setInterval(() => { i = (i + 1) % urls.length; setSrc(urls[i]); }, rotateMs);
      }
      return wrap;
    };

    // event card
    const card = (e, imageMs) => {
      const media = imageRotator(e.images, imageMs);
      const body  = el('div', { class:'card__body' }, [
        el('h3', { class:'card__title' }, [e.title || 'Evento']),
        el('p',  { class:'muted' },      [e.whenText || e.when || '']),
        el('p',  { class:'card__excerpt'},[e.description || '']),
        e.link ? el('a', { class:'btn secondary', href: e.link, target:'_blank', rel:'noopener' }, ['Más info']) : el('span')
      ]);
      const wrap = el('article', { class:'card events-card' }, [media, body]);
      return wrap;
    };

    // normalize rows coming from the API
    const normalize = (data) => {
      return (Array.isArray(data) ? data : []).map(x => {
        // images may arrive as array or comma-separated string
        const images = Array.isArray(x.images)
          ? x.images
          : String(x.images || x.image || '')
              .split(',')
              .map(s => s.trim())
              .filter(Boolean);

        const status = String(x.status || 'publish').toLowerCase();

        const rawDate = String(x.date || x.when || '').trim();
        const dt = rawDate ? new Date(rawDate) : null;

        return {
          title: x.title || x.name || '',
          when: rawDate,
          whenText: rawDate || '',
          description: x.description || x.desc || '',
          link: x.link || x.url || '',
          images,
          status,
          _dt: isFinite(dt?.getTime?.()) ? dt : null
        };
      });
    };

    // filter + sort based on mode
    const filterSort = (rows, mode) => {
      const today = new Date(); today.setHours(0,0,0,0);
      const visible = rows.filter(r => !['hide','hidden','draft','no'].includes(r.status));

      if (mode === 'past') {
        const past = visible.filter(r => r._dt && r._dt < today);
        // newest past first
        past.sort((a,b) => b._dt - a._dt);
        return past;
      }

      if (mode === 'upcoming') {
        const future = visible.filter(r => !r._dt || r._dt >= today);
        // soonest first; undated last
        future.sort((a,b) => {
          const A = a._dt ? a._dt.getTime() : Infinity;
          const B = b._dt ? b._dt.getTime() : Infinity;
          return A - B;
        });
        return future;
      }

      // mode === 'all' (not used here)
      const all = [...visible];
      all.sort((a,b) => {
        const A = a._dt ? a._dt.getTime() : Infinity;
        const B = b._dt ? b._dt.getTime() : Infinity;
        return A - B;
      });
      return all;
    };

    const renderInto = (mount, items) => {
      const limitAttr = Number(mount.getAttribute('data-limit') || '0'); // 0 = sin límite
      const imageMs   = Number(mount.getAttribute('data-image-rotate-ms') || '5000');
      const grid = el('div', { class:'newsgrid' });
      mount.innerHTML = '';
      mount.appendChild(grid);

      const list = (!limitAttr || items.length <= limitAttr) ? items : items.slice(0, limitAttr);
      list.forEach(ev => grid.appendChild(card(ev, imageMs)));
    };

    // boot
    (async () => {
      try {
        const res = await fetch(API + (API.includes('?') ? '&' : '?') + '_=' + Date.now(), { cache:'no-store' });
        const raw = await res.json();
        const rows = normalize(raw);

        // render each mount according to its data-mode
        mounts.forEach(m => {
          const mode = (m.getAttribute('data-mode') || 'upcoming').toLowerCase();
          const list = filterSort(rows, mode);
          renderInto(m, list);
        });
      } catch(e) {
        console.error('Events feed error:', e);
      }
    })();
  })();
  </script>
  <!-- === /Events feed (MEXSA) === -->

  <!-- === Semester calendar feed (simple sheet) === -->
  <script>
    // ############## CONFIG (Semester calendar) ##############
    // Your new semester sheet Apps Script Web App endpoint (current + next month only):
    window.SEMESTER_API_URL = 'https://script.google.com/macros/s/AKfycbwzQxCWcrOLqw_iVfaPwIs4RCnhcb9F0ZuAdVOXyGVK9i5m50CFtXjDJO0M32T_yOsQsg/exec';
    // ############ END CONFIG ############
  </script>
  <script>
  (() => {
    const API = window.SEMESTER_API_URL;
    const mount = document.getElementById('semester-calendar');
    if (!API || !mount) return;

    const el = (t, a={}, kids=[]) => {
      const n = document.createElement(t);
      for (const [k,v] of Object.entries(a)) {
        if (k === 'class') n.className = v;
        else if (k === 'html') n.innerHTML = v;
        else n.setAttribute(k, v);
      }
      kids.forEach(k => n.appendChild(typeof k === 'string' ? document.createTextNode(k) : k));
      return n;
    };

    const monthKey = (dStr) => {
      const d = dStr ? new Date(dStr) : null;
      if (!d || isNaN(d)) return '';
      // e.g., "Nov 2025"
      return d.toLocaleString('en-US', { month:'long', year:'numeric' });
    };

    const monthSortVal = (dStr) => {
      const d = dStr ? new Date(dStr) : null;
      return (!d || isNaN(d)) ? Infinity : (d.getFullYear()*12 + d.getMonth());
    };

    const renderMonthCard = (title, items) => {
      const ul = el('ul', { class:'bullets' });
      items.forEach(it => {
        const line = `${it.date_label || ''} — ${it.title || ''}${it.location ? ` (${it.location})` : ''}`;
        ul.appendChild(el('li', {}, [line]));
      });

      return el('article', { class:'card' }, [
        el('div', { class:'card__body' }, [
          el('h3', { class:'card__title' }, [title]),
          ul
        ])
      ]);
    };

    (async () => {
      try {
        const res = await fetch(API + (API.includes('?') ? '&' : '?') + '_=' + Date.now(), { cache:'no-store' });
        const data = await res.json();
        const rows = Array.isArray(data) ? data : [];

        // Group by month (already filtered by script to current + next)
        const groups = new Map();
        rows.forEach(r => {
          const key = monthKey(r.date);
          if (!key) return;
          if (!groups.has(key)) groups.set(key, []);
          groups.get(key).push(r);
        });

        // Sort months by date asc; within month, sort by date asc
        const monthEntries = Array.from(groups.entries())
          .sort((a,b) => monthSortVal(a[1][0]?.date) - monthSortVal(b[1][0]?.date));

        mount.innerHTML = '';
        if (!monthEntries.length) {
          mount.appendChild(el('p', { class:'muted' }, ['No hay eventos publicados para este mes.']));
          return;
        }

        monthEntries.forEach(([title, items]) => {
          items.sort((a,b) => new Date(a.date) - new Date(b.date));
          mount.appendChild(renderMonthCard(title, items));
        });
      } catch (e) {
        console.error('Semester calendar error:', e);
        mount.innerHTML = '<p class="muted">No se pudo cargar el calendario.</p>';
      }
    })();
  })();
  </script>
  <!-- === /Semester calendar feed === -->
</body>
</html>









